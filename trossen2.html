<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" />
<title>WidowX AI IK demo</title><style>html,body{margin:0;height:100%;overflow:hidden}</style>
<!-- import-mapâ€¦ (see Step 1) -->
</head><body><script type="module">
import * as THREE from 'three';
import { OrbitControls }    from 'three/examples/jsm/controls/OrbitControls.js';
import { TransformControls }from 'three/examples/jsm/controls/TransformControls.js';
import URDFLoader           from 'urdf-loader';
import {
  urdfRobotToIKRoot, setIKFromUrdf, setUrdfFromIK,
  IKRootsHelper, Goal, Solver
} from 'closed-chain-ik';

/* 1) renderer / scene / camera ------------------------------------------------*/
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight); document.body.appendChild(renderer.domElement);
const scene  = new THREE.Scene(); scene.background = new THREE.Color(0x202020);
const camera = new THREE.PerspectiveCamera(50,innerWidth/innerHeight,0.01,100);
camera.position.set(0.4,0.4,0.4);

scene.add(new THREE.DirectionalLight(0xffffff,4));
scene.add(new THREE.AmbientLight(0xffffff,2));

const orbit = new OrbitControls(camera,renderer.domElement);
const gizmo = new TransformControls(camera,renderer.domElement); scene.add(gizmo);

/* 2) load URDF ---------------------------------------------------------------*/
const loader = new URDFLoader();
loader.fetchOptions={mode:'cors'};
loader.packages={'trossen_arm_description':
  '/assets/trossen_arm_description'};
const urdf = await loader.loadAsync(
  'public/assets/trossen_arm_description/urdf/generated/wxai/wxai_base.urdf'
);
urdf.traverse(c=>{ if(c.jointType==='revolute') c.jointType='continuous'; });
scene.add(urdf);

/* 3) IK ----------------------------------------------------------------------*/
const ik = urdfRobotToIKRoot(urdf); ik.setDoF();
urdf.rotation.set(-Math.PI/2,0,0); ik.setEuler(-Math.PI/2,0,0);

const eeLink = ik.find(n=>n.name==='ee_gripper_link');
const goal = new Goal(); goal.setPosition(0.35,0.15,0); goal.makeClosure(eeLink);

const helper = new IKRootsHelper([ik,goal]); helper.setColor(0x2196f3).setJointScale(0.03);
scene.add(helper);

const solver = new Solver([ik,goal]);

/* 4) drag gizmo --------------------------------------------------------------*/
const target = new THREE.Group(); scene.add(target); gizmo.attach(target);

function updateGoalFromGizmo(){
  goal.setPosition(target.position.x,target.position.y,target.position.z);
  goal.setQuaternion(target.quaternion.x,target.quaternion.y,target.quaternion.z,target.quaternion.w);
}

/* 5) render loop -------------------------------------------------------------*/
function loop(){
  requestAnimationFrame(loop);
  updateGoalFromGizmo();
  setIKFromUrdf(ik,urdf);
  solver.solve();
  setUrdfFromIK(urdf,ik);
  renderer.render(scene,camera);
}
loop();
</script></body></html>
