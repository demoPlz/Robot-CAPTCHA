# Quick USB Recovery Commands
# Run these individually when USB subsystem crashes

# 1. FASTEST: Reset USB modules (usually works)
sudo modprobe -r xhci_pci && sudo modprobe xhci_pci

# 2. Reset all USB controller modules
sudo modprobe -r xhci_pci xhci_hcd ehci_pci ehci_hcd ohci_pci ohci_hcd uhci_hcd
sudo modprobe xhci_pci xhci_hcd ehci_pci ehci_hcd ohci_pci ohci_hcd uhci_hcd

# 3. Reset USB controllers via sysfs
sudo find /sys/bus/pci/drivers/*/unbind -exec echo {} \; 2>/dev/null | grep -E "(ehci|ohci|uhci|xhci)" | while read unbind; do echo "$(basename $(dirname $unbind))" | sudo tee "$unbind"; done
sudo echo 1 | sudo tee /sys/bus/pci/rescan

# 4. Reset specific USB device (replace XXXX:YYYY with device ID from lsusb)
# sudo sh -c 'echo "XXXX YYYY" > /sys/bus/usb/drivers/usb/unbind'
# sudo sh -c 'echo "XXXX YYYY" > /sys/bus/usb/drivers/usb/bind'

# 5. Check if robot is detected (replace with your robot's vendor:product ID)
lsusb | grep -i "robot\|arm\|dynamixel\|ftdi"

# 6. Reset V4L2 (video) devices if cameras are affected
sudo modprobe -r uvcvideo && sudo modprobe uvcvideo
